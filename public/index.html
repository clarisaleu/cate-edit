<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Super hands with croquet</title>

    <!-- Networked Audio -->
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <script src="easyrtc/easyrtc.js"></script>
    <script src="https://unpkg.com/networked-aframe@^0.6.0/dist/networked-aframe.min.js"></script>

    <!--   Physics/Superhands   -->
    <script src="https://unpkg.com/super-hands/dist/super-hands.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@^4.1.1/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-physics-extras/dist/aframe-physics-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>

    <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/@croquet/croquet@0.4.0"></script>

    <!-- import the webpage's javascript file -->
    <script src="./script/system.js" type="module"></script>
    <script src="./script/croquet-component.js" type="module"></script>
    <script src="./script/index.js" type="module"></script>
  </head>
  <body>
    
    <!-- Set debug to true to see boundary boxes -->
    <a-scene
      networked-scene="
      room: audio;
      adapter: easyrtc;
      audio: true;
      debug: true;"
      physics="debug: true"
      environment="preset: threetowers; shadow: true"
    >
      <!-- User -->
      <template id="userTemplate">
        <a-entity class="avatar" networked-audio-source>
          <a-sphere
            class="user"
            color="blue"
            position="0 1 0"
            networked-audio-source
            physics-collider
            dynamic-body
            visible="true"
          >
          </a-sphere>
        </a-entity>
      </template>

      <a-assets>
        <!-- Mixins -->
        <a-mixin
          id="cube"
          geometry="primitive: box; width: 0.33; height: 0.33; depth: 0.33"
          hoverable
          grabbable
          stretchable
          draggable
          event-set__hoveron="_event: hover-start; material.opacity: 0.7; transparent: true"
          event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false"
          dynamic-body
          shadow
        ></a-mixin>

        <a-mixin
          id="transformer"
          color-randomizer
          droppable
          static-body
          collision-filter="collisionForces: false"
          event-set__dragon="_event: dragover-start; material.wireframe: true"
          event-set__dragoff="_event: dragover-end; material.wireframe: false"
          geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5"
        ></a-mixin>

        <a-mixin
          id="touch"
          physics-collider
          phase-shift
          collision-filter="collisionForces: false"
          static-body="shape: sphere; sphereRadius: 0.02"
          super-hands="colliderEvent: collisions;
                              colliderEventProperty: els;
                              colliderEndEvent: collisions;
                              colliderEndEventProperty: clearedEls;"
        ></a-mixin>

        <a-mixin
          geometry="primitive: box; width: 1; height: 1; depth: 1"
          dynamic-body
          shadow
        ></a-mixin>
      </a-assets>

      <a-entity movement-controls id="parent-entity-player">
        <a-entity
          id="player"
          wasd-controls
          look-controls
          networked="template:#userTemplate;attachTemplateToLocal:false;"
          camera
          position="0 1 0"
        ></a-entity>
        <a-entity id="rhand" mixin="touch" hand-controls="hand: right">
        </a-entity>
        <a-entity id="lhand" mixin="touch" hand-controls="hand: left">
        </a-entity>
      </a-entity>

      <!--   Lighting     -->
      <a-entity
        croquet="name: light"
        light="color: #FFF; intensity: 0.6; castShadow: true"
        position="-0.5 1 1"
      ></a-entity>
      <a-entity
        croquet="name: ambientLight"
        light="color: #BBB; type: ambient"
      ></a-entity>

      <a-text
        croquet="name: text"
        value="VR Dodgeball"
        color="black"
        align="center"
        scale="10 10 10"
        position="0 6 -6"
        id="label"
      ></a-text>

      <!-- TODO see if this sphere can be manipulated by multiple users -->
      <!--    Dynamic-Bodies    -->
      <a-box
        id="box1"
        hoverable
        grabbable
        stretchable
        draggable
        dropppable
        dynamic-body
        shadow
        position="0 0.265 -1"
        color="red"
      ></a-box>

      <a-sphere
        id="obj"
        hoverable
        grabbable
        stretchable
        draggable
        dropppable
        dynamic-body
        shadow
        radius="0.7"
        position="0.5 2 0.5"
        rotation="0 0 0"
        color="black"
      ></a-sphere>

      <a-box
        id="box2"
        hoverable
        grabbable
        stretchable
        draggable
        dropppable
        dynamic-body
        shadow
        position="-5 1 -5"
        color="blue"
      ></a-box>

      <a-cylinder
        id="cylin1"
        position="-2 0.75 -2"
        radius="0.25"
        height="2"
        dynamic-body
        shadow
      ></a-cylinder>

      <a-cylinder
        id="cylin2"
        position="2 0.75 -2"
        radius="0.5"
        height="2"
        color="#FFC65D"
        dynamic-body
        shadow
      ></a-cylinder>

      <!-- ground collider keeps objects from falling -->
      <a-box
        static-body
        width="100"
        height="0.01"
        depth="100"
        visible="false"
      ></a-box>
      
    </a-scene>
  </body>
  <!--  Randomize Location of Camera  -->
  <script src="./script/randomizeLocation.js"></script>
</html>
